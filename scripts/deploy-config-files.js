!function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("ansi-colors")},function(e,t){e.exports=require("rimraf")},function(e,t){e.exports=require("ncp")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("chokidar")},function(e,t,r){e.exports=r(8)},function(e,t,r){"use strict";r.r(t);var s=r(0),i=r(2),n=r.n(i),o=r(1);var a=class{constructor(e){this.stats=e=>Object(o.lstat)(this.path,(t,r)=>{if(t)throw t;e(r)}),this.exists=()=>Object(o.existsSync)(this.path),this.path=e.path,this.predecessors=e.path.split(s.sep),this.name=this.predecessors[this.predecessors.length-1],this.parent=this.predecessors.slice(0,this.predecessors.length-1).join(s.sep)}};class c extends a{constructor(){super(...arguments),this.create=({fileCreated:e})=>Object(o.appendFile)(this.path,"",t=>{if(t)throw t;e&&e()}),this.read=({encoding:e,dataReady:t})=>Object(o.readFile)(this.path,e||c.defaultReadSettings.encoding,(e,r)=>{if(e)throw e;t(r)}),this.write=({data:e,dataWritten:t})=>Object(o.writeFile)(this.path,e,e=>{if(e)throw e;t&&t()}),this.remove=({fileRemoved:e})=>this.exists()&&Object(o.unlink)(this.path,t=>{if(t)throw t;e&&e()}),this.copy=({newPath:e,fileCopied:t})=>this.read({dataReady:r=>{const s=new c({path:e});s.write({data:r,dataWritten:()=>t(s)})}}),this.move=({newPath:e,fileMoved:t})=>this.copy({newPath:e,fileCopied:e=>t(e)})}}c.defaultReadSettings={encoding:"utf8"};var p=c,h=r(3),l=r.n(h),d=r(4),u=r.n(d),f=r(5),m=r(6),g=r.n(m);const y=e=>e?`${e}: `:"";var b=({event:e,sourcePath:t,targetPath:r,corePath:s,messagePrefix:i})=>{switch(e){case"addDir":((e,t,r)=>{new w({path:e}).create(()=>{console.log(`${y(r)}${n.a.greenBright(`+${t}`)}`)})})(r,s,i);break;case"add":case"change":((e,t,r,s)=>{new p({path:e}).copy({newPath:t,fileCopied:()=>{console.log(`${y(s)}${n.a.greenBright(`+${r}`)}`)}})})(t,r,s,i);break;case"unlink":((e,t,r)=>{new p({path:e}).remove({fileRemoved:()=>{console.log(`${y(r)}${n.a.redBright(`-${t}`)}`)}})})(r,s,i);break;case"unlinkDir":((e,t,r)=>{new w({path:e}).remove(()=>{console.log(`${y(r)}${n.a.redBright(`-${t}`)}`)})})(r,s,i)}};class j extends a{constructor(){super(...arguments),this.children=e=>{Object(o.readdir)(this.path,(t,r)=>{if(t)throw t;{const t=[],i=[];r.forEach(n=>{const o={path:Object(s.resolve)(this.path,n)};new a(o).stats(s=>{s.isDirectory()?i.push(new j(o)):t.push(new p(o)),r.length===t.length+i.length&&e({directories:i,files:t})})})}})},this.child=({childName:e,childReady:t})=>this.children(({files:r,directories:s})=>t(r.find(t=>t.name===e)||s.find(t=>t.name===e))),this.files=e=>this.children(({files:t})=>e(t)),this.file=({fileName:e,fileReady:t})=>this.files(r=>t(r.find(t=>t.name===e))),this.directories=e=>this.children(({directories:t})=>e(t)),this.directory=({directoryName:e,directoryReady:t})=>this.directories(r=>t(r.find(t=>t.name===e))),this.remove=e=>l()(this.path,e),this.copy=({newPath:e,directoryCopied:t})=>u()(this.path,e,e=>{if(e)throw e;t()}),this.run=({command:e,parameters:t,commandExited:r})=>{const s={};s.cwd=this.path;const i=Object(f.spawn)(e,t,s);i.stdout.on("data",e=>console.log(e.toString())),i.stderr.on("data",e=>console.log(e.toString())),i.on("exit",e=>r(e,i))},this.watch=e=>e(g.a.watch(Object(s.resolve)(this.path))),this.create=e=>Object(o.mkdir)(this.path,e),this.sync=(e,t="")=>{this.copy({newPath:e,directoryCopied:()=>{this.watch(r=>setTimeout(()=>r.on("all",(r,s)=>{const i=s.substring(this.path.length,s.length);b({event:r,sourcePath:s,targetPath:[e,i].join(""),corePath:i,messagePrefix:t})}),1e3))}})}}}var v,w=j;class O{static parse(){return process.argv.slice(2).map(O.detectInput).reduce(O.mergeInput,[])}static parameters(){return O.parse().reduce((e,t)=>{const r=Object.assign({},e);return r[t.label]=t.value.length>1?t.value:t.value[0],r},{})}static parameter(e){return O.parameters()[e]}}O.detectInput=e=>{const t="--"===e.substring(0,2),r="-"===e.substring(0,1),s=t||r;return{text:t?e.substring(2,e.length):r?e.substring(1,e.length):e,type:s?"label":"value"}},O.mergeInput=(e,t)=>{if("label"===t.type)e.push({label:t.text,value:[]});else{if(!e.length)throw"CLI input must be labeled with '-' or '--'";e[e.length-1].value.push(t.text)}return e},function(e){e.LOCAL="local",e.APP="app",e.SHARED="shared"}(v||(v={}));class x{static sync(){O.parameter("project-path")||console.error(n.a.red("Error: Missing path of related project")),x.developmentInstance().directory({directoryName:"src",directoryReady:e=>{e.sync(Object(s.resolve)(x.projectInstance().path,"src"))}}),x.developmentInstance().directory({directoryName:"scripts",directoryReady:e=>{e.sync(Object(s.resolve)(x.projectInstance().path,"scripts"))}})}}x.projectInstance=()=>new w({path:Object(s.resolve)(process.cwd(),O.parameter("project-path"),"node_modules","@elumeo","jfs-core")}),x.developmentInstance=()=>new w({path:Object(s.resolve)(__dirname,"..")}),x.detectEnvironment=({modeDetected:e})=>{if(!!Object(o.existsSync)(Object(s.resolve)(process.cwd(),O.parameter("project-path"),"package.json"))){new p({path:Object(s.resolve)(process.cwd(),O.parameter("project-path"),"package.json")}).read({encoding:"utf8",dataReady:t=>{const{name:r}=JSON.parse(t),s="jfc"===r.substring(0,"jfc".length);e(s?v.SHARED:v.APP)}})}},x.deployAppSettings=()=>{x.detectEnvironment({modeDetected:e=>{if(e!==v.LOCAL){const e=new w({path:Object(s.resolve)(process.cwd(),O.parameter("project-path"))}),t=new w({path:Object(s.resolve)(__dirname,"..","settings")});t.directory({directoryName:"frontend",directoryReady:r=>{t.files(t=>{r.files(r=>{let i=0;const o=[...r.filter(({name:e})=>["tsconfig.json","tslint.json"].includes(e)),...t];o.forEach(t=>{t.copy({newPath:Object(s.resolve)(e.path,t.name),fileCopied:()=>{++i===o.length&&(console.log(n.a.greenBright("Deployed config files\n")),o.map(({name:e})=>console.log(n.a.greenBright(`-- ${e}`))))}})})})})}})}}})},x.scriptsDirectory=e=>{x.developmentInstance().directory({directoryName:"scripts",directoryReady:t=>e(t)})},x.scriptFiles=e=>{x.scriptsDirectory(t=>t.directory({directoryName:"Setup",directoryReady:t=>t.files(t=>e(t))}))},x.compileScripts=e=>{const t=e[0];x.scriptsDirectory(r=>t.copy({newPath:Object(s.resolve)(r.path,"index.ts"),fileCopied:()=>{r.run({command:"npm",parameters:["run","build-scripts","--","--output-filename",t.name.replace(".ts",".js")],commandExited:()=>{e.length>1&&x.compileScripts(e.slice(1,e.length))}})}}))},x.deployAppSettings()}]);